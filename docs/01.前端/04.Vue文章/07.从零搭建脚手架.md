---
title: 从零搭建脚手架
date: 2022-09-14 10:40:28
permalink: /pages/895bc6/
categories:
  - 前端
  - Vue文章
tags:
  - 手摸手系列
---

# 从零搭建脚手架

从零实现一个类似vue-cli的脚手架,可以自定义拉取的模板和功能,提升日常开发的效率

### 1. 自定义命令行指令

想要向 `vue-cli` 或者 `vite` 一样,在命令行中直接输入指令执行其实非常简单,只需要在 `package.json` 中添加 `bin` 字段,指向 `bin` 目录下的文件,使用 `npm link` 连接即可

> npm link 可以帮助我们模拟包安装后的状态，它会在系统中做一个快捷方式映射，让本地的包就好像install过一样，可以直接使用。

<code-group>
  <code-block title="terminal" active>
  ``` bash
    # 创建 cli 文件夹
    mkdir my-cli 
    # 初始化项目
    cd my-cli && npm init -y
    # 创建 bin 目录 和 my-cli.js 文件
    mkdir bin && touch my-cli.js
  ```
  </code-block>

  <code-block title="package.json">
  ```json
    {
      // ...
      "bin": "bin/my-cli.js"
    }
  ```
  </code-block>
</code-group>

我们在 `my-cli.js` 中添加一个log,运行 `npm link` 后 运行 `my-cli` 测试下效果

``` js
#! /usr/bin/env node
console.log('测试npm-link')
```
> my-cli.js 文件中 第一行 需要添加 #! /usr/bin/env node 识别为可执行脚本

![img](/img/npm-link.png)

可以看到我们运行自定义命令 `my-cli` 成功输出了内容!

### 2. 引入相关npm包

#### 2.1 [commander](https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md) 
`commander` 是一个完整的 `node.js` 命令行解决方案 提供了用户命令行输入和参数解析强大功能

**基本配置**   
  
<code-group>
  <code-block title="安装">
  ``` zsh
  // 安装依赖
  npm install commander
  ```
  </code-block>

  <code-block title="package.json">
  ``` json
  // 修改node导入方式为import / export
  {
    ...
    "type": "module",
    ...
  }
  ```
  </code-block>

  <code-block title="my-cli.js">
  ``` js
  // 在node中使用require 
  import { createRequire } from 'module'
  const require = createRequire(import.meta.url)

  // 引入commander
  const program = require("commander");

  // 基本配置
  program
    .name("my-cli") // 名称
    .usage(`<command> [option]`) // 首行提示文字
    .version(`my-cli ${require('../package.json').version}`); // 版本号,通过package.json获取

  {/* ..... */}

  // 解析用户执行时输入的参数,请将此代码放在所有代码最下方
  // `process.argv` 是 `nodejs` 提供的属性
  program.parse(process.argv)
  ```
  </code-block>

</code-group>

:::tip 
commander 自身附带了 --help 指令，导入成功后，在命令行执行 demo --help，可以打印出基本的帮助提示。
:::

![img](/img/commander.png)   

#### 2.2 [chalk](https://github.com/chalk/chalk)
chalk 是一个命令行美化工具,可以美化我们在命令行中输出内容的样式，例如实现多种颜色，花里胡哨的命令行提示等

**基本配置**


<code-group>
  <code-block title="安装">
  ``` zsh
  npm install chalk
  ```
  </code-block>

  <code-block title="使用">
  ``` js
  // in my-cli.js
  import chalk from 'chalk'

  // outher code ...

  // 监听 --help 指令 使用 chalk.cyan 修改颜色
  program.on("--help", function () {
  // 前后两个空行调整格式，更舒适
    console.log();
    console.log(
      `运行 ${chalk.cyan(
        "hayai <command> --help"
      )} 查看具体命令的详细用法.`
    );
    console.log();
  });

  // last code 
  program.parse(process.argv);
  ```
  </code-block>
</code-group>

