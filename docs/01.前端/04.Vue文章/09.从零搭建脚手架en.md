---
title: Implement a scaffold from zero
date: 2022-09-14 10:40:28
categories: 
  - å‰ç«¯
  - Vueæ–‡ç« 
tags: 
  - æ‰‹æ‘¸æ‰‹ç³»åˆ—
permalink: /pages/264fde/
---

## Implement a scaffold from zero 

implement a like vue-cli scaffold from zero, it can be customize the template and featrue for improve development efficiency 

## 1. customize command line directive

It's very simple to type command on the command line like vue-cli or vite ,only need to add `bin` field in `package.json` and use `npm link` to connect

> npm link can help us simulate the state of the package after installation,It will be do a mapping in the system  Make the local package as if it has been installed and can be used directly.

<code-group>
  <code-block title="terminal" active>
  ``` bash
    # åˆ›å»º cli æ–‡ä»¶å¤¹
    mkdir my-cli 
    # åˆå§‹åŒ–é¡¹ç›®
    cd my-cli && npm init -y
    # åˆ›å»º bin ç›®å½• å’Œ my-cli.js æ–‡ä»¶
    mkdir bin && touch my-cli.js
  ```
  </code-block>

  <code-block title="package.json">z
  ```json
    {
      // ...
      "bin": "bin/my-cli.js"
    }
  ```
  </code-block>
</code-group>

Add a log in `my-cli.js`, after run npm link ,run `my-cli` command to the test effect

``` js
#! /usr/bin/env node
console.log('æµ‹è¯•npm-link')
```
> the first line in my-cli.js file need to be add `#! /usr/bin/env node ` is recognized as an executable script  
![img](/img/npm-link.png)

You can see that we run the custom command 'my-cli' to output the content successfully!

## 2.  Introduce the relevant NPM package

### 2.1 [commander](https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md) 
`commander` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ `node.js` å‘½ä»¤è¡Œè§£å†³æ–¹æ¡ˆ æä¾›äº†ç”¨æˆ·å‘½ä»¤è¡Œè¾“å…¥å’Œå‚æ•°è§£æå¼ºå¤§åŠŸèƒ½

**åŸºæœ¬é…ç½®**   
  
<code-group>
  <code-block title="å®‰è£…">
  ``` zsh
  // å®‰è£…ä¾èµ–
  npm install commander
  ```
  </code-block>

  <code-block title="package.json">
  ``` json
  // ä¿®æ”¹nodeå¯¼å…¥æ–¹å¼ä¸ºimport / export
  {
    ...
    "type": "module",
    ...
  }
  ```
  </code-block>

  <code-block title="my-cli.js">
  ``` js
  // åœ¨nodeä¸­ä½¿ç”¨require 
  import { createRequire } from 'module'
  const require = createRequire(import.meta.url)

  // å¼•å…¥commander
  const program = require("commander");

  // åŸºæœ¬é…ç½®
  program
    .name("my-cli") // åç§°
    .usage(`<command> [option]`) // é¦–è¡Œæç¤ºæ–‡å­—
    .version(`my-cli ${require('../package.json').version}`); // ç‰ˆæœ¬å·,é€šè¿‡package.jsonè·å–

  {/* ..... */}

  // è§£æç”¨æˆ·æ‰§è¡Œæ—¶è¾“å…¥çš„å‚æ•°,è¯·å°†æ­¤ä»£ç æ”¾åœ¨æ‰€æœ‰ä»£ç æœ€ä¸‹æ–¹
  // `process.argv` æ˜¯ `nodejs` æä¾›çš„å±æ€§
  program.parse(process.argv)
  ```
  </code-block>

</code-group>

:::tip 
commander è‡ªèº«é™„å¸¦äº† --help æŒ‡ä»¤ï¼Œå¯¼å…¥æˆåŠŸåï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œ demo --helpï¼Œå¯ä»¥æ‰“å°å‡ºåŸºæœ¬çš„å¸®åŠ©æç¤ºã€‚
:::

![img](/img/commander.png)   

### 2.2 [chalk](https://github.com/chalk/chalk)
`chalk` æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¾åŒ–å·¥å…·,å¯ä»¥ç¾åŒ–æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å‡ºå†…å®¹çš„æ ·å¼ï¼Œä¾‹å¦‚å®ç°å¤šç§é¢œè‰²ï¼ŒèŠ±é‡Œèƒ¡å“¨çš„å‘½ä»¤è¡Œæç¤ºç­‰

**åŸºæœ¬é…ç½®**


<code-group>
  <code-block title="å®‰è£…">
  ``` zsh
  npm install chalk
  ```
  </code-block>

  <code-block title="ä½¿ç”¨">
  ``` js
  // in my-cli.js
  import chalk from 'chalk'

  // outher code ...

  // ç›‘å¬ --help æŒ‡ä»¤ ä½¿ç”¨ chalk.cyan ä¿®æ”¹é¢œè‰²
  program.on("--help", function () {
  // å‰åä¸¤ä¸ªç©ºè¡Œè°ƒæ•´æ ¼å¼ï¼Œæ›´èˆ’é€‚
    console.log();
    console.log(
      `è¿è¡Œ ${chalk.cyan(
        "hayai <command> --help"
      )} æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.`
    );
    console.log();
  });

  // last code 
  program.parse(process.argv);
  ```
  </code-block>
</code-group>

å®Œæˆé…ç½®å,æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹å§!æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º
![img](/img/chark.png)

### 2.3 [inquirer](https://github.com/SBoudrias/Inquirer.js)
`inquirer` æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œäº¤äº’å·¥å…·,æ”¯æŒ Confirm ç¡®è®¤ï¼ŒList å•é€‰ï¼ŒCheckbox å¤šé€‰ç­‰å¤šç§äº¤äº’æ–¹å¼

<code-group>
  <code-block title="å®‰è£…">
  ``` zsh
  npm install --save inquirer
  ```
  </code-block>
</code-group>

è¿™é‡Œå…ˆå®‰è£…,æˆ‘ä»¬ç¨åå†å®æˆ˜ä¸­ä½¿ç”¨å®ƒ!

### 2.4 [ora](https://github.com/sindresorhus/ora)
`ora` æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥åˆ›å»ºloadingæ•ˆæœ,ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•,æˆ‘ä»¬è¿˜æ˜¯å…ˆå®‰è£…

  ``` zsh
  npm install ora
  ```


### 2.5 [fs-extra](https://github.com/jprichardson/node-fs-extra)
`fs-extra` æ¨¡å—æ˜¯ç³»ç»Ÿ fs æ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº† fs æ¨¡å—çš„ APIã€‚æ¯” fs ä½¿ç”¨èµ·æ¥æ›´åŠ å‹å¥½ã€‚
  ``` zsh
  npm install fs-extra
  ```


### 2.6 [degit](https://github.com/Rich-Harris/degit)
`degit` æ˜¯ä¸€ä¸ªç±»å‹gitçš„ä»“åº“å…‹éš†å·¥å…·,ä¸»ä½“æ˜¯å‘½ä»¤è¡Œå·¥å…·,æä¾›äº†Js Api æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ‹‰å–æˆ‘ä»¬çš„æ¨¡æ¿,éå¸¸çš„æ–¹ä¾¿ä¸å¿«æ·

  ``` zsh
  npm install -g degit
  ```


### 2.7 [figlet](https://github.com/patorjk/figlet.js)
`figlet` ç”¨æ¥ç”Ÿæˆè‰ºæœ¯å­—ä½“,è£…é¥°æˆ‘ä»¬çš„å‘½ä»¤è¡Œæ ·å¼
  ``` zsh
  npm install figlet
  ```

## 3. é…ç½® create å‘½ä»¤
æˆ‘ä»¬æ¥é…ç½® `create` å‘½ä»¤ï¼Œè¯¥å‘½ä»¤è´Ÿè´£åˆ›å»ºé¡¹ç›®ã€‚åŒæ—¶åœ¨è¿™é‡Œæˆ‘ä»¬æ·»åŠ  --force å‚æ•°ï¼Œé»˜è®¤è¦†ç›–å½“å‰é¡¹ç›®ã€‚(å…³äºå­˜åœ¨åŒåç›®å½•çš„æƒ…å†µï¼Œåæ–‡æœ‰è¯¦ç»†å¤„ç†)
::: tip commander å‘½ä»¤ç®€è¦è¯´æ˜
1. commander æä¾›äº† command æ–¹æ³•ï¼Œ command æ–¹æ³•çš„ç¬¬ä¸€å‚æ•°ä¸ºå‘½ä»¤åç§°ï¼Œå‘½ä»¤å‚æ•°è·Ÿéšåœ¨åç§°åé¢(å¿…é€‰å‚æ•°ä½¿ç”¨ <> è¡¨ç¤ºï¼Œå¯é€‰å‚æ•°ä½¿ç”¨ [] è¡¨ç¤º)   
2. option æ–¹æ³•å¯ä»¥å®šä¹‰é€‰é¡¹ï¼ŒåŒæ—¶å¯ä»¥é™„åŠ é€‰é¡¹çš„ç®€ä»‹ã€‚æ¯ä¸ªé€‰é¡¹å¯ä»¥å®šä¹‰ä¸€ä¸ªçŸ­é€‰é¡¹åç§°ï¼ˆ-åé¢æ¥å•ä¸ªå­—ç¬¦ï¼‰å’Œä¸€ä¸ªé•¿é€‰é¡¹åç§°ï¼ˆ--åé¢æ¥ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ï¼‰ï¼Œä½¿ç”¨é€—å·ã€ç©ºæ ¼æˆ–|åˆ†éš”ã€‚
3. description ç”¨æ¥æ·»åŠ æè¿°ä¿¡æ¯
4. action æ–¹æ³•ç”¨æ¥å¤„ç†æ“ä½œ
:::

æˆ‘ä»¬åœ¨my-cli.jsä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ä»£ç 
``` js 
program
  .command("create <project-name>") // å¢åŠ åˆ›å»ºæŒ‡ä»¤
  .description("create a new project") // æ·»åŠ æè¿°ä¿¡æ¯
  .option("-f, --force", "overwrite target directory if it exists") // å¼ºåˆ¶è¦†ç›–
  .action((projectName, cmd) => {
    // å¤„ç†ç”¨æˆ·è¾“å…¥create æŒ‡ä»¤é™„åŠ çš„å‚æ•°
    console.log(projectName,'ç”¨æˆ·è¾“å…¥çš„é¡¹ç›®åç§°', cmd,'å‚æ•°å¯¹è±¡ optioné…ç½®çš„.');

  });
```
è¿è¡Œ my-cli å‘½ä»¤ å¦‚å›¾æ‰€ç¤º æ‹¿åˆ°äº†è¾“å…¥çš„ä¿¡æ¯

![img](/img/create.png)

## 4. å®ç° create å‘½ä»¤
æˆ‘ä»¬åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª `lib`ç›®å½•,å…¶ä¸­åˆ›å»º `create.js` ç”¨æ¥å®ç°åˆ›å»ºå‘½ä»¤

``` zsh
mkdir lib && cd lib && touch create.js
```
æˆ‘ä»¬å…ˆå¯¼å‡ºä¸€ä¸ªå‡½æ•°,åœ¨my-cliçš„`commander create action`å‘½ä»¤ä¸­è°ƒç”¨

<code-group>
  <code-block title="create.js">
  ``` js
  export default async function create (projectName, options){
    {/** do someing */}
  }
  ```
  </code-block>

  <code-block title="my-cli.js">
  ``` js
  import create from '../lib/create.js'
  program
    .command("create <project-name>") // å¢åŠ åˆ›å»ºæŒ‡ä»¤
    .description("create a new project") // æ·»åŠ æè¿°ä¿¡æ¯
    .option("-f, --force", "overwrite target directory if it exists") // å¼ºåˆ¶è¦†ç›–
    .action(async (projectName, cmd) => {
      // åœ¨è¿™é‡Œè°ƒç”¨,ç”±äºåˆ›å»ºæ–‡ä»¶æ˜¯å¼‚æ­¥æ“ä½œ,æˆ‘ä»¬ä½¿ç”¨await åŒæ­¥ä»£ç å—
      await create(projectName,cmd)

    });
  ```
  </code-block>
</code-group>


### 4.1 å®Œæˆç›®å½•çš„è¦†ç›–
æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®Œå–„create.jsçš„ä»£ç ,é¦–å…ˆæ¥å®Œæˆç›®å½•è¦†ç›–çš„åŠŸèƒ½,ä¸»è¦æœ‰äº†ä¸¤ä¸ªé€»è¾‘   

1. å¦‚æœç›®æ ‡ç›®å½•å­˜åœ¨,ä½¿ç”¨forceå‚æ•°åˆ™å¼ºåˆ¶è¦†ç›–åˆ›å»º
2. å¦‚æœç›®æ ‡ç›®å½•å­˜åœ¨,æœªä½¿ç”¨forceå‚æ•°,åˆ™äº¤äº’è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦è¦†ç›–åˆ›å»º


::: tip
åˆ›å»ºutilsæ–‡ä»¶å¤¹,å…¶ä¸­å­˜å‚¨ora å’Œ apiçš„ç›¸å…³é€»è¾‘
:::

<code-group>
  <code-block title="create.js">
 ``` js
import path from 'node:path' 
import fs from 'fs-extra'
import inquirer from 'inquirer'
import { loading } from '../utils/ora.js'
  export default async function create (projectName, options){
   // è·å–å½“å‰å·¥ä½œç›®å½•
  const cwd = process.cwd();
  // æ‹¼æ¥å¾—åˆ°é¡¹ç›®ç›®å½•
  const targetDirectory = path.join(cwd, projectName);
  // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨
  if (fs.existsSync(targetDirectory)) {
    // åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ --force å‚æ•°
    if (options.force) {
      // åˆ é™¤é‡åç›®å½•(removeæ˜¯ä¸ªå¼‚æ­¥æ–¹æ³•)
      await fs.remove(targetDirectory);
    } else {
      // è°ƒç”¨inquirer æ’ä»¶ è®©ç”¨æˆ·äº¤äº’
      let { isOverwrite } = await new inquirer.prompt([
        // è¿”å›å€¼ä¸ºpromise
        {
          name: "isOverwrite", // ä¸è¿”å›å€¼å¯¹åº”
          type: "list", // list ç±»å‹
          message: "ç›®æ ‡ç›®å½•å­˜åœ¨ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªæ“ä½œ",
          choices: [
            { name: "Overwrite", value: true },
            { name: "Cancel", value: false },
          ],
        },
      ]);
      // é€‰æ‹© Cancel 
      if (!isOverwrite) {
        console.log("Cancel");
        return;
      } else {
        // é€‰æ‹© Overwrite ï¼Œå…ˆåˆ é™¤æ‰åŸæœ‰é‡åç›®å½•
        console.log("\r\nRemoving");
        await loading(
          `Removing ${projectName}, please wait a minute`,
          fs.remove,
          targetDirectory)
      }
    }
  }
  }

```
  </code-block>

  <code-block title="utils/ora.js">
  ``` js
/**
 * ç¡è§‰å‡½æ•°
 * @param {Number} n ç¡çœ æ—¶é—´
 */
 function sleep(n) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve();
    }, n);
  });
}

/**
 * loadingåŠ è½½æ•ˆæœ
 * @param {String} message åŠ è½½ä¿¡æ¯
 * @param {Function} fn åŠ è½½å‡½æ•°
 * @param {List} args fn å‡½æ•°æ‰§è¡Œçš„å‚æ•°
 * @returns å¼‚æ­¥è°ƒç”¨è¿”å›å€¼
 */
import ora from 'ora'
export async function  loading(message, fn, ...args) {
  const spinner = ora(message);
  spinner.start(); // å¼€å¯åŠ è½½
  try {
    let executeRes = await fn(...args);
    // åŠ è½½æˆåŠŸ
    spinner.succeed();
    return executeRes;
  } catch (error) {
    // åŠ è½½å¤±è´¥
    console.log(error)
    spinner.fail("request fail, refetching");
    await sleep(1000);
    // é‡æ–°æ‹‰å–
    return loading(message, fn, ...args);
  }
}

  ```
  </code-block>
</code-group>

### 4.2 æ¨¡æ¿æ–‡ä»¶çš„æ‹‰å–
æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªapiæ–‡ä»¶,ç”¨æ¥è·å–githubä»“åº“ä¿¡æ¯,åœ¨utilsç›®å½•ä¸‹åˆ›å»ºapi.js ä»£ç å¦‚ä¸‹
  ``` js
  import axios from 'axios'

// æ‹¦æˆªå…¨å±€è¯·æ±‚å“åº”
axios.interceptors.response.use((res) => {
  return res.data;
});

/**
 * è·å–æ¨¡æ¿
 * @returns Promise ä»“åº“ä¿¡æ¯
 */
async function gethayaiRepo() {
  return axios({ url: 'https://api.github.com/orgs/hayai-cli/repos', method: 'GET', headers: { "Authorization": `token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` } })
}

/**
 * è·å–ä»“åº“ä¸‹çš„ç‰ˆæœ¬
 * @param {string} repo æ¨¡æ¿åç§°
 * @returns Promise ç‰ˆæœ¬ä¿¡æ¯
 */
async function getTagsByRepo(repo) {
  return axios.get(`https://api.github.com/repos/hayai-cli/${repo}/tags`);
}

export  {
  gethayaiRepo,
  getTagsByRepo,
};
```
::: warning 
æˆ‘ä»¬é€šè¿‡githubæä¾›çš„apiæ¥è°ƒå–githubä»“åº“ä¿¡æ¯,è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªgithubç»„ç»‡,åœ°å€ä¿®æ”¹ä¸ºä½ ç»„ç»‡çš„åœ°å€
> github api æœ‰é»˜è®¤çš„è¯·æ±‚é™åˆ¶,å¯ä»¥ç”³è¯·æ›´é«˜é™åˆ¶,ä¼ å…¥åˆ°tokenä¸­
:::

æˆ‘ä»¬æ¥ç€ç¼–å†™å…·ä½“çš„æ‹‰å–æ¨¡æ¿ä»£ç 

create.js

  ``` js
  // æˆ‘ä»¬åœ¨createå‡½æ•°æœ€ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç ,å…·ä½“é€»è¾‘æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç±»æ¥å®ç°
  import Creator from './Creator.js'
  const creator = new Creator(projectName, targetDirectory);
  creator.create();
  ```

Creator.js

  ``` js
  import ora from 'ora'
  import inquirer from 'inquirer'
  import { loading } from '../utils/ora.js'
  import { gethayaiRepo, getTagsByRepo } from '../utils/api.js'
  import downloadGitRepo from 'download-git-repo'
  import chalk from "chalk"
  import util from 'util'
  import degit from 'degit'

  import path from 'path'
  export default class Creator {
    // é¡¹ç›®åç§°åŠé¡¹ç›®è·¯å¾„
    constructor(name, target) {
      this.name = name;
      this.target = target;
      // è½¬åŒ–ä¸º promise æ–¹æ³•
      this.downloadGitRepo = util.promisify(downloadGitRepo);
    }
    // åˆ›å»ºé¡¹ç›®éƒ¨åˆ†
    async create() {
      // ä»“åº“ä¿¡æ¯ â€”â€” æ¨¡æ¿ä¿¡æ¯
      let repo = await this.getRepoInfo();
      await this.download(repo)
      // æ¨¡æ¿ä½¿ç”¨æç¤º
      console.log(`\r\nSuccessfully created project ${chalk.cyan(this.name)}`);
      console.log(`\r\n  cd ${chalk.cyan(this.name)}`);
      console.log("  npm install");
      console.log("  npm run serve\r\n");
    }
    async download(repo, tag) {
      // æ¨¡æ¿ä¸‹è½½åœ°å€
      const templateUrl = `hayai-cli/${repo}`;
      // è°ƒç”¨ downloadGitRepo æ–¹æ³•å°†å¯¹åº”æ¨¡æ¿ä¸‹è½½åˆ°æŒ‡å®šç›®å½•
      const spinner = ora('æ­£åœ¨ä¸‹è½½');
      spinner.start(); // å¼€å¯åŠ è½½
      const emitter = degit(templateUrl, {
        cache: false,
      });
      await emitter.clone(this.target)
      spinner.succeed('ğŸ† å®‰è£…å®Œæˆ');
    }
    async getRepoInfo() {
      // è·å–ç»„ç»‡ä¸‹çš„ä»“åº“ä¿¡æ¯
      let repoList = await loading(
        "waiting for fetching template",
        gethayaiRepo
      );
      const filterList = ['.github', 'core']
      repoList = repoList.filter((item) => {
        if (!filterList.includes(item.name)) {
          return item
        }
      })
      if (!repoList) return;
      // æå–ä»“åº“å
      const repos = repoList.map((item) => item.name);
      // é€‰å–æ¨¡æ¿ä¿¡æ¯
      let { repo } = await new inquirer.prompt([
        {
          name: "repo",
          type: "list",
          message: "Please choose a template to create project",
          choices: repos,
        },
      ]);
      return repo;
    }
  }
  ```

## 5. æ€»ç»“
åˆ°ç›®å‰ä¸ºæ­¢,æ‰€æœ‰åŸºæœ¬é…ç½®å·¥ä½œå·²ç»å®Œæˆ,å‰©ä½™åŠŸèƒ½å¯ä»¥è‡ªè¡Œå¼€å‘   

æ‰€æœ‰å®Œæ•´ä»£ç å¦‚ä¸‹   

<code-group>
  <code-block title="bin/my-cli.js">
  ``` js
  #! /usr/bin/env node
  import '../lib/commander.js'
  ```
  </code-block>

  <code-block title="lib/commander.js">
  ``` js
  import { createRequire } from 'module'
  const require = createRequire(import.meta.url)
  import chalk from 'chalk'
  import create from './create.js'
  const program = require("commander");
  program
    .name("hayai")
    .usage(`<command> [option]`)
    .version(`hayai ${require('../package.json').version}`);
  program.command("create <project-name>") // å¢åŠ åˆ›å»ºæŒ‡ä»¤
    // .description("create a new project") // æ·»åŠ æè¿°ä¿¡æ¯
    .description("create å‘½ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®") // æ·»åŠ æè¿°ä¿¡æ¯
    .option("-f, --force", "å¦‚æœå­˜åœ¨ï¼Œåˆ™è¦†ç›–ç›®æ ‡ç›®å½•") // å¼ºåˆ¶è¦†ç›–
    .action(async (projectName, cmd) => {
      // å¤„ç†ç”¨æˆ·è¾“å…¥create æŒ‡ä»¤é™„åŠ çš„å‚æ•°
      await create(projectName, cmd);
    });
  program
    .command("config [value]") // config å‘½ä»¤
    .description("æ£€æŸ¥å’Œä¿®æ”¹é…ç½®")
    .option("-g, --get <key>", "get value by key")
    .option("-s, --set <key> <value>", "set option[key] is value")
    .option("-d, --delete <key>", "delete option by key")
    .action((value, keys) => {
      // value å¯ä»¥å–åˆ° [value] å€¼ï¼Œkeysä¼šè·å–åˆ°å‘½ä»¤å‚æ•°
      // console.log(value, keys);
    });
  // ç›‘å¬ --help æŒ‡ä»¤
  program.on("--help", function () {
    // å‰åä¸¤ä¸ªç©ºè¡Œè°ƒæ•´æ ¼å¼ï¼Œæ›´èˆ’é€‚
    // å‰åä¸¤ä¸ªç©ºè¡Œè°ƒæ•´æ ¼å¼ï¼Œæ›´èˆ’é€‚
    console.log();
    // console.log(
    //   `Run ${chalk.cyan(
    //     "hayai <command> --help"
    //   )} for detailed usage of given command.`
    // );
    console.log(
      `è¿è¡Œ ${chalk.cyan(
        "hayai <command> --help"
      )} æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.`
    );
    console.log();
  });
  program.parse(process.argv);
  ```
  </code-block>

  <code-block title="lib/create.js">
  ``` js
import path from 'node:path'
import fs from 'fs-extra'
import inquirer from 'inquirer'
import Creator from './Creator.js'
import { loading } from '../utils/ora.js'
import { gethayaiRepo, getTagsByRepo } from '../utils/api.js'
import { log } from 'node:console'
export default async function create(projectName, options) {
  // console.log(projectName, options, '2');
  // è·å–å½“å‰å·¥ä½œç›®å½•
  const cwd = process.cwd();
  // æ‹¼æ¥å¾—åˆ°é¡¹ç›®ç›®å½•
  const targetDirectory = path.join(cwd, projectName);
  // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨
  if (fs.existsSync(targetDirectory)) {
    console.log(33);
    // åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ --force å‚æ•°
    if (options.force) {
      // åˆ é™¤é‡åç›®å½•(removeæ˜¯ä¸ªå¼‚æ­¥æ–¹æ³•)
      await fs.remove(targetDirectory);
    } else {
      let { isOverwrite } = await new inquirer.prompt([
        // è¿”å›å€¼ä¸ºpromise
        {
          name: "isOverwrite", // ä¸è¿”å›å€¼å¯¹åº”
          type: "list", // list ç±»å‹
          message: "ç›®æ ‡ç›®å½•å­˜åœ¨ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªæ“ä½œ",
          choices: [
            { name: "Overwrite", value: true },
            { name: "Cancel", value: false },
          ],
        },
      ]);
      // é€‰æ‹© Cancel
      if (!isOverwrite) {
        console.log("Cancel");
        return;
      } else {
        // é€‰æ‹© Overwrite ï¼Œå…ˆåˆ é™¤æ‰åŸæœ‰é‡åç›®å½•
        console.log("\r\nRemoving");
        await loading(
          `Removing ${projectName}, please wait a minute`,
          fs.remove,
          targetDirectory)
      }
    }
  }
  const creator = new Creator(projectName, targetDirectory);
  creator.create();
};
  ```
  </code-block>

  <code-block title="utils/ora.js">
  ``` js 
    /**
  * ç¡è§‰å‡½æ•°
  * @param {Number} n ç¡çœ æ—¶é—´
  */
  function sleep(n) {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve();
      }, n);
    });
  }
  /**
  * loadingåŠ è½½æ•ˆæœ
  * @param {String} message åŠ è½½ä¿¡æ¯
  * @param {Function} fn åŠ è½½å‡½æ•°
  * @param {List} args fn å‡½æ•°æ‰§è¡Œçš„å‚æ•°
  * @returns å¼‚æ­¥è°ƒç”¨è¿”å›å€¼
  */
  import ora from 'ora'
  export async function  loading(message, fn, ...args) {
    const spinner = ora(message);
    spinner.start(); // å¼€å¯åŠ è½½
    try {
      let executeRes = await fn(...args);
      // åŠ è½½æˆåŠŸ
      spinner.succeed();
      return executeRes;
    } catch (error) {
      // åŠ è½½å¤±è´¥
      console.log(error)
      spinner.fail("request fail, refetching");
      await sleep(1000);
      // é‡æ–°æ‹‰å–
      return loading(message, fn, ...args);
    }
  }
```
  </code-block>

  <code-block title="utils/api.js">
  ``` js
  import axios from 'axios'
  // æ‹¦æˆªå…¨å±€è¯·æ±‚å“åº”
  axios.interceptors.response.use((res) => {
    return res.data;
  });
  /**
  * è·å–æ¨¡æ¿
  * @returns Promise ä»“åº“ä¿¡æ¯
  */
  async function gethayaiRepo() {
    return axios({ url: 'https://api.github.com/orgs/hayai-cli/repos', method: 'GET', headers: { "Authorization": `token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` } })
  }
  /**
  * è·å–ä»“åº“ä¸‹çš„ç‰ˆæœ¬
  * @param {string} repo æ¨¡æ¿åç§°
  * @returns Promise ç‰ˆæœ¬ä¿¡æ¯
  */
  async function getTagsByRepo(repo) {
    return axios.get(`https://api.github.com/repos/hayai-cli/${repo}/tags`);
  }
  export  {
    gethayaiRepo,
    getTagsByRepo,
  };
```
  </code-block>
</code-group>
