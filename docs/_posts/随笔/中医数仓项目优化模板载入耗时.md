---
title: ä¸­åŒ»æ•°ä»“é¡¹ç›®ä¼˜åŒ–æ¨¡æ¿è½½å…¥è€—æ—¶å°è®°
date: 2021-07-09 16:52:08
permalink: /pages/283fff/
sidebar: auto
categories:
  - éšç¬”
tags:
  - 
---
# trans-ast

## é‡åˆ°çš„é—®é¢˜
åœ¨ä¸­åŒ»é¡¹ç›®ä½¿ç”¨htmlä½œä¸ºæ¨¡æ¿ä¿å­˜ç—…ä¾‹,å‰ç«¯éœ€è¦è§£æå¤§é‡htmlå­—ç¬¦ä¸²,è¿›è¡Œè‡ªå®šä¹‰å±æ€§,æ ·å¼,ç±»å‹ç­‰æ“ä½œ,åŸç”Ÿdomæ“ä½œé€ æˆè½½å…¥æ¨¡æ¿è€—æ—¶è¿‡é•¿çš„é—®é¢˜

![img](/img/mbtree.png)
## éœ€è¦è§£æåšçš„äº‹æƒ…
1. è§£æhtmlå­—ç¬¦ä¸²,æ‹¿åˆ°æ‰€æœ‰å…ƒç´ çš„sidå’Œid,è¯·æ±‚æ¥å£å¾—åˆ°å¯¹åº”å…ƒç´ çš„å†…å®¹
2. æ ¹æ®æ¥å£è¿”å›å‚æ•°è®¾ç½®å¯¹åº”çš„å…ƒç´ çš„ç±»å‹:~~date~~,~~datetime~~,text,select,checkbox,radio
3. å¦‚ç±»å‹ä¸æ˜¯text,åˆ™è§£æå¾…é€‰é¡¹list,è®¾ç½®ç»™å¯¹åº”å…ƒç´ 


<div>
    å¦‚å›¾ç¤ºä¾‹:
    <img src="/img/event.png"  height="750" width="1030" style="text-algin:center">
 </div>

## è§£æhtmlå­—ç¬¦ä¸²çš„æ–¹å¼
1. createDocumentFragment()
è½¬æ¢ä¸ºæ–‡æ¡£ç‰‡æ®µ,è¿›è¡Œdomæ“ä½œ,è§£æåè¿”å›

2. createElement()
è½¬æ¢ä¸ºçœŸå®domæ“ä½œ  
``` js
async function render (renderHtml,vue) {
  const fragment = document.createDocumentFragment()
  // or
  const parentElement = document.createElement('div');
  parentElement.innerHTML = renderHtml;
  // todo..
}
``` 
<div>
ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»è§£æåçš„æ•°æ®,åŸç”ŸDOM
    <img src="/img/111.png"  height="" width="800" style="text-algin:center">
 </div>

## ç¼ºç‚¹
1. ä¸æ–¹ä¾¿æ“ä½œè‡ªå®šä¹‰å±æ€§å’Œå†…å®¹,å±‚çº§æ··ä¹±,è·å–ä¸è®¾ç½®éº»çƒ¦
2. æ“ä½œåŸç”Ÿdomä¸ç¬¦åˆmvvmæ¡†æ¶æ€æƒ³,ä»£ç æµç¨‹é•¿ä¸”å¤æ‚   
3. æ•ˆç‡è¾ƒä½   
![img](/img/context.png)
![img](/img/dm1.png)
![img](/img/dm2.png)
::: tip domæ“ä½œèƒƒç‚æ¨¡æ¿,éšè¯Šæ¨¡æ¿,å¤è¯Šæ¨¡æ¿çš„åˆå§‹è€—æ—¶
![img](/img/old.png)
:::

## è§£å†³æ€è·¯
> å‚è€ƒè™šæ‹Ÿdom,ç”¨jså¯¹è±¡æ–¹å¼æ¨¡æ‹ŸdomèŠ‚ç‚¹,è¿›è¡Œå±æ€§æ“ä½œã€‚ 

æ‰‹åŠ¨æ„å»ºASTæŠ½è±¡è¯­æ³•æ ‘,é‡‡ç”¨å››åˆ™è¿ç®—æ‹¬å·åŒ¹é…çš„ç›¸åŒæœºåˆ¶,å¯¹æ¨¡æ¿è¿›è¡Œæ­£åˆ™è§£æ,æ‰‹åŠ¨æ„å»ºå¯¹è±¡,å…·ä½“æµç¨‹å¯åœ¨æˆ‘å†™çš„`mini-vue`ä¸­æŸ¥çœ‹    
![img](/img/ast11.png)
::: tip astæ“ä½œæ“ä½œèƒƒç‚æ¨¡æ¿,éšè¯Šæ¨¡æ¿,å¤è¯Šæ¨¡æ¿çš„åˆå§‹è€—æ—¶
![img](/img/new.png)
:::


## è§£å†³æ–¹æ³•æç‚¼æˆæ’ä»¶
å°†è§£å†³æ–¹æ³•æç‚¼æˆä¸€ä¸ªé€šç”¨æ’ä»¶,é‡åˆ°éœ€è¦è§£æhtmlçš„æ“ä½œ,éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨,ä¼˜åŒ–æ•ˆç‡

å¯ä»¥å°†htmlå­—ç¬¦ä¸²è§£æä¸ºASTå¯¹è±¡çš„ä¸€ä¸ªæ’ä»¶,æä¾›Templateè½¬AST,ASTè½¬DOMçš„åŠŸèƒ½,è§£æå¤§é‡HTMLå­—ç¬¦ä¸²çš„æ•ˆç‡ç›¸æ¯”ä¼ ç»ŸDOMæ“ä½œæå‡25å€ä»¥ä¸Š  

## å®‰è£…
`npm install --save trans-ast`   
or  
`yarn add trans-ast`

## ä½¿ç”¨
Nodeç¯å¢ƒ   
`const $AST = require("trans-ast")`    
  
Vue æˆ– React   
`import $AST from 'trans-ast'`   
## æä¾›æ–¹æ³•
### parseAST(template)

|  å‚æ•°   | æè¿°  |
|:---|:---|
| template (å¿…é¡») | Stringç±»å‹,åˆæ³•çš„htmlå­—ç¬¦ä¸² |
|  è¿”å›å€¼   | æè¿°  |
|    AST   | Objectç±»å‹,è§£æåçš„ASTå¯¹è±¡ |

<br/>

### parseDOM(AST)
|  å‚æ•°   | æè¿°  |
|:---|:---|
| AST (å¿…é¡») | Objectç±»å‹,ç”±parseASTæ–¹æ³•è§£æåçš„ASTå¯¹è±¡ |
|  è¿”å›å€¼   | æè¿°  |
|   ElementNode   | NodeèŠ‚ç‚¹,ASTè½¬æ¢åçš„DOM |

<br/>

## ASTå±æ€§è¯´æ˜   
   
|  å±æ€§   | æè¿°  |
|:---|:---|
| attrsMap | Mapç±»å‹çš„æ ‡ç­¾å±æ€§,åŒ…å«è‡ªå®šä¹‰å±æ€§ |
| attrslist | Listç±»å‹çš„æ ‡ç­¾å±æ€§,åŒ…å«è‡ªå®šä¹‰å±æ€§ |
| children | å½“å‰å…ƒç´ çš„å­å…ƒç´  |
| parent | å½“å‰å…ƒç´ çš„çˆ¶å…ƒç´  (å·²åºŸå¼ƒ)|
| tag | æ ‡ç­¾åç§° |
| type | 1:å…ƒç´  2:æ–‡æœ¬  |
| expression| å¯æ‰§è¡Œå­—ç¬¦ä¸²,åç»­ç‰ˆæœ¬ä¼šæ”¯æŒç›´æ¥è§£æ
| text | æ–‡æœ¬å†…å®¹ |
     
     
## vueä¸­å…¨å±€æ³¨å†Œ

``` js
// å¼•å…¥
import $AST from 'trans-ast'
// æ³¨å†Œ
vue.prototype.$AST = $AST
// ä½¿ç”¨
vm.$AST.parseAST(template)
vm.$AST.parseDOM(AST)
```